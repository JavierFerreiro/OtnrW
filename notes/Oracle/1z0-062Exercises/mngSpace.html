<h2>Exercises Of Managing Space</h2>
<h3>Officials</h3>
<h3>Xavi's propossed</h3>
<p>
1-Create a user with basic permissions (connect, create table) and a own data 
tablespace of 200MB.
<button type="button" onclick="$('#Answer1').toggleClass('hidden');">Answer</button>
  <div id="Answer1" class="hidden answer">
		<code>
    create smallfile tablespace test_ts <br>
		&nbsp;&nbsp;datafile '/u01/app/oracle/oradata/orcl/test_ts_1.dbf' size 200M;<br>
		create user test identified by test<br> 
		&nbsp;&nbsp;default tablespace test_ts temporary tablespace temp quota unlimited on test_ts<br>
		&nbsp;&nbsp;account unlock;<br>
		grant connect to test;<br>
		grant create table to test;<br>
		</code>
  </div>
2-Create a table with only one column that accepts numbers. Fill it with 
consecutives numbers enough to fill 25MB (aprox).
<button type="button" onclick="$('#Answer2').toggleClass('hidden');">Answer</button>
<div id="Answer2" class="hidden answer">
	<code>
  create table t1 (c1 number(7));<br>
  begin<br>
	&nbsp;&nbsp;for i in 1..3000000<br>
	&nbsp;&nbsp;loop<br>
	&nbsp;&nbsp;&nbsp;&nbsp;insert into t1 values (i);<br>
	&nbsp;&nbsp;end loop;<br>
	end;<br>
	/<br> 
	commit;<br>
	</code>
</div><br>
3-Calculate the free space of the tablespace.
<button type="button" onclick="$('#Answer3').toggleClass('hidden');">Answer</button>
<div id="Answer3" class="hidden answer">
	<code>
		select sum(bytes)/1024/1024 from dba_free_space where tablespace_name='TEST_TS';<br>
	</code>
</div><br>

4-Delete the odd values of the column.
<button type="button" onclick="$('#Answer4').toggleClass('hidden');">Answer</button>
<div id="Answer4" class="hidden answer">
	<code>
		delete from t1 where mod(c1,2)=0;<br>
		commit;<br>
  </code>
</div><br>
5-Check that the free space is not changed (repeat step 3).<br>
6-Try to obtain a advice from the Segment Advisor with a manual running.
<button type="button" onclick="$('#Answer6').toggleClass('hidden');">Answer</button>
<div id="Answer6" class="hidden answer">
	<code>
		declare<br>
			name varchar2(100);<br>
			descr varchar2(200);<br>
			obj_id number;<br>
		begin<br>
			name := 'Manual_T1';<br>
			descr :=	'Segment Advisor task for test.t1';<br>
			dbms_advisor.create_task(<br>
				advisor_name => 'Segment Advisor',<br>
				task_id => obj_id,<br>
				task_name => name,<br>
				task_desc => descr);<br>
			dbms_advisor.create_object(<br>
				task_name => name,<br>
				object_type => 'TABLE',<br>
				attr1 => 'TEST',<br>
				attr2 => 'T1',<br>
				attr3 => NULL,<br>
				attr4 => NULL,<br>
				attr5 => NULL,<br>
				object_id => obj_id);<br>
			dbms_advisor.set_task_parameter(<br>
				task_name => name,<br>
				parameter => 'recommend_all',<br>
				value => 'TRUE');<br>
			dbms_advisor.execute_task(name);<br>
		end;<br>
		/<br>
		select tablespace_name,segment_name,segment_type,partition_name,<br>
					 recommendations, c1<br>
		from table(dbms_space.asa_recommendations('TRUE','TRUE','FALSE'));<br>
	</code>
</div><br>
7-shrink the table.
<button type="button" onclick="$('#Answer7').toggleClass('hidden');">Answer</button>
<div id="Answer7" class="hidden answer">
	<code>
		alter table test.t1 enable row movement;<br>
		alter table test.t1 shrink space;<br>
	</code>
</div><br>
8-Alternative, you can do a redefinition that hasn't (almost) lock time (but 
need more than 2x space).
<button type="button" onclick="$('#Answer8').toggleClass('hidden');">Answer</button>
<div id="Answer8" class="hidden answer">
	<code>
		create table test.t2 as <br>
			(select * from test.t1 where c1<>c1); --Use dbms_metada for more complex<br>
																						-- tables<br>
			begin<br>
				dbms_redefinition.start_redef_table('TEST','T1','T2',NULL,<br>
																					dbms_redefinition.cons_use_rowid);<br>
			end;<br>
			/<br>
			begin<br>
				dbms_redefinition.finish_redef_table('TEST','T1','T2');<br>
			end;<br>
			/<br>
			drop table test.t2 purge;<br>
			--Be awere of constraints, dependencies...<br>
	</code>
</div><br>
Other Support code:
<button type="button" onclick="$('#Answer9').toggleClass('hidden');">Answer</button>
<div id="Answer9" class="hidden answer">
	<code>
    declare<br>
			name varchar2(100);<br>
		begin<br>
  		name:='Manual_T1';<br>
  		dbms_advisor.cancel_task(name);<br>
		end;<br>
		/<br>
		declare<br>
  		name varchar2(100);<br>
		begin<br>
  		name:='Manual_T1';<br>
  		dbms_advisor.delete_task(name);<br>
		end;<br>
		/<br>
	begin<br>
  	dbms_redefinition.abort_redef_table('PROVA','T1','T2');<br>
	end;<br>
	/<br>
  drop user prova cascade;<br>
	drop tablespace prova_ts including contents and datafiles;<br>
	</code>
</div>
</p>

